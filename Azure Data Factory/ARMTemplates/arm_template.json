{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "factoryName": {
            "type": "string",
            "metadata": "Data Factory name",
            "defaultValue": "rsmedpovdfhggd"
        },
        "AzureSqlDatabase_connectionString": {
            "type": "secureString",
            "metadata": "Secure string for 'connectionString' of 'AzureSqlDatabase'"
        },
        "AzureSQLTSA_connectionString": {
            "type": "secureString",
            "metadata": "Secure string for 'connectionString' of 'AzureSQLTSA'"
        },
        "AzureBlobStorage1_connectionString": {
            "type": "secureString",
            "metadata": "Secure string for 'connectionString' of 'AzureBlobStorage1'"
        },
        "AzureSynapseAnalytics1_connectionString": {
            "type": "secureString",
            "metadata": "Secure string for 'connectionString' of 'AzureSynapseAnalytics1'"
        },
        "AzureSQLMAPS_connectionString": {
            "type": "secureString",
            "metadata": "Secure string for 'connectionString' of 'AzureSQLMAPS'"
        },
        "AzureKeyVault_properties_typeProperties_baseUrl": {
            "type": "string",
            "defaultValue": "https://rsmedpovkvhggd.vault.azure.net/"
        },
        "AzureDataLakeStorageGen2_properties_typeProperties_url": {
            "type": "string",
            "defaultValue": "https://rsmedpovdlhggd.dfs.core.windows.net"
        },
        "AzureDataLakeStoreLanding_Binary_properties_typeProperties_fileName": {
            "type": "string",
            "defaultValue": ""
        },
        "AzureDataLakeStoreLanding_Binary_properties_typeProperties_folderPath": {
            "type": "string",
            "defaultValue": "@concat(pipeline().parameters.ContainerName,activity('uspGetCopyActivitySinkFileToADLS').output.firstRow.CopyActivityDataADLSFolderPath)"
        },
        "AzureDataLakeStoreFile_Txt_properties_typeProperties_fileName": {
            "type": "string",
            "defaultValue": "@dataset().FileName"
        },
        "AzureDataLakeStoreFile_Txt_properties_typeProperties_folderPath": {
            "type": "string",
            "defaultValue": "@dataset().FilePath"
        },
        "AzureDataLakeStore_Archive_properties_typeProperties_folderPath": {
            "type": "string",
            "defaultValue": "@concat(pipeline().parameters.ContainerName,'/Raw/Archive')"
        },
        "AzureDataLakeStoreFile_properties_typeProperties_fileName": {
            "type": "string",
            "defaultValue": "@activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataADLSFileName"
        },
        "AzureDataLakeStoreFile_properties_typeProperties_folderPath": {
            "type": "string",
            "defaultValue": "@activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataADLSFolderPath"
        }
    },
    "variables": {
        "factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
    },
    "resources": [
        {
            "name": "[concat(parameters('factoryName'), '/SelfHostedIntegrationRuntime')]",
            "type": "Microsoft.DataFactory/factories/integrationRuntimes",
            "apiVersion": "2018-06-01",
            "properties": {
                "type": "SelfHosted",
                "typeProperties": {}
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureKeyVault')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureKeyVault",
                "typeProperties": {
                    "baseUrl": "[parameters('AzureKeyVault_properties_typeProperties_baseUrl')]"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureDatabricksFramework')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureDatabricks",
                "typeProperties": {
                    "domain": "https://adb-8969623093352290.10.azuredatabricks.net",
                    "accessToken": {
                        "type": "AzureKeyVaultSecret",
                        "store": {
                            "referenceName": "AzureKeyVault",
                            "type": "LinkedServiceReference"
                        },
                        "secretName": "DatabricksFrameworkAdminToken",
                        "secretVersion": ""
                    },
                    "existingClusterId": "1230-211941-metes655"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureKeyVault')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureDatabricksData001')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureDatabricks",
                "typeProperties": {
                    "domain": "https://adb-6096087961322221.1.azuredatabricks.net",
                    "accessToken": {
                        "type": "AzureKeyVaultSecret",
                        "store": {
                            "referenceName": "AzureKeyVault",
                            "type": "LinkedServiceReference"
                        },
                        "secretName": "DatabricksDataAdminToken",
                        "secretVersion": ""
                    },
                    "existingClusterId": "1230-213547-after889"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureKeyVault')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDatabase')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureSqlDatabase",
                "typeProperties": {
                    "connectionString": "[parameters('AzureSqlDatabase_connectionString')]",
                    "password": {
                        "type": "AzureKeyVaultSecret",
                        "store": {
                            "referenceName": "AzureKeyVault",
                            "type": "LinkedServiceReference"
                        },
                        "secretName": "SqlframeworkPassword"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureKeyVault')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureDataLakeStorageGen2')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureBlobFS",
                "typeProperties": {
                    "url": "[parameters('AzureDataLakeStorageGen2_properties_typeProperties_url')]"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSQLTSA')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureSqlMI",
                "typeProperties": {
                    "connectionString": "[parameters('AzureSQLTSA_connectionString')]",
                    "password": {
                        "type": "AzureKeyVaultSecret",
                        "store": {
                            "referenceName": "AzureKeyVault",
                            "type": "LinkedServiceReference"
                        },
                        "secretName": "SQLDBTSAPassword"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureKeyVault')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureBlobStorage1')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureBlobStorage",
                "typeProperties": {
                    "connectionString": "[parameters('AzureBlobStorage1_connectionString')]"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSynapseAnalytics1')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureSqlDW",
                "typeProperties": {
                    "connectionString": "[parameters('AzureSynapseAnalytics1_connectionString')]"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSQLMAPS')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureSqlDatabase",
                "typeProperties": {
                    "connectionString": "[parameters('AzureSQLMAPS_connectionString')]",
                    "password": {
                        "type": "AzureKeyVaultSecret",
                        "store": {
                            "referenceName": "AzureKeyVault",
                            "type": "LinkedServiceReference"
                        },
                        "secretName": "SQLFrameworkPassword"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureKeyVault')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/FrameworkAzureSqlTable')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSqlDatabase",
                    "type": "LinkedServiceReference"
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Container"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSQLDatabase')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSqlDatabase",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "TableName": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [
                    {
                        "name": "CopyActivityDataSQLScriptKey",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "CopyActivityDataSQLScriptName",
                        "type": "varchar"
                    },
                    {
                        "name": "CopyActivityDataSqlScript",
                        "type": "varchar"
                    },
                    {
                        "name": "IsActive",
                        "type": "bit"
                    },
                    {
                        "name": "LastRunDate",
                        "type": "datetime2",
                        "scale": 7
                    },
                    {
                        "name": "CreateDate",
                        "type": "date"
                    },
                    {
                        "name": "ModifiedDate",
                        "type": "date"
                    },
                    {
                        "name": "ModifiedUser",
                        "type": "varchar"
                    }
                ],
                "typeProperties": {
                    "schema": "dbo",
                    "table": {
                        "value": "@concat(dataset().TableName,'_Staging')",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureDataLakeStoreLanding_Binary')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorageGen2",
                    "type": "LinkedServiceReference"
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "type": "AzureBlobFSFile",
                "typeProperties": {
                    "fileName": "[parameters('AzureDataLakeStoreLanding_Binary_properties_typeProperties_fileName')]",
                    "folderPath": {
                        "value": "[parameters('AzureDataLakeStoreLanding_Binary_properties_typeProperties_folderPath')]",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorageGen2')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureDataLakeStoreFile_Txt')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorageGen2",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "FilePath": {
                        "type": "string"
                    },
                    "FileName": {
                        "type": "string"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "type": "AzureBlobFSFile",
                "typeProperties": {
                    "format": {
                        "type": "TextFormat",
                        "columnDelimiter": "|",
                        "rowDelimiter": "",
                        "quoteChar": "\"",
                        "treatEmptyAsNull": true,
                        "skipLineCount": 0,
                        "firstRowAsHeader": true
                    },
                    "fileName": {
                        "value": "[parameters('AzureDataLakeStoreFile_Txt_properties_typeProperties_fileName')]",
                        "type": "Expression"
                    },
                    "folderPath": {
                        "value": "[parameters('AzureDataLakeStoreFile_Txt_properties_typeProperties_folderPath')]",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorageGen2')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureDataLakeStore_Archive')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorageGen2",
                    "type": "LinkedServiceReference"
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "type": "AzureBlobFSFile",
                "typeProperties": {
                    "folderPath": {
                        "value": "[parameters('AzureDataLakeStore_Archive_properties_typeProperties_folderPath')]",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorageGen2')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureDataLakeStoreFile')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorageGen2",
                    "type": "LinkedServiceReference"
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "type": "AzureBlobFSFile",
                "typeProperties": {
                    "format": {
                        "type": "JsonFormat",
                        "filePattern": "setOfObjects"
                    },
                    "fileName": {
                        "value": "[parameters('AzureDataLakeStoreFile_properties_typeProperties_fileName')]",
                        "type": "Expression"
                    },
                    "folderPath": {
                        "value": "[parameters('AzureDataLakeStoreFile_properties_typeProperties_folderPath')]",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorageGen2')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureDataLakeStoreFile_Json')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorageGen2",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "FilePath": {
                        "type": "string"
                    },
                    "FileName": {
                        "type": "string"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "type": "Json",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobFSLocation",
                        "fileName": {
                            "value": "@dataset().FileName",
                            "type": "Expression"
                        },
                        "folderPath": {
                            "value": "@dataset().FilePath",
                            "type": "Expression"
                        }
                    }
                },
                "schema": {}
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorageGen2')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TSASQLTable')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSQLTSA",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlMITable",
                "schema": [],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Answers"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSQLTSA')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/SourceDataset_qeu')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureBlobStorage1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobStorageLocation",
                        "fileName": "client_report_by_monthend_detail.csv",
                        "folderPath": "Landing",
                        "container": "rsm"
                    },
                    "columnDelimiter": ",",
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": []
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureBlobStorage1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/DestinationDataset_qeu')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSynapseAnalytics1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlDWTable",
                "schema": [
                    {
                        "name": "client_number",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "client_name",
                        "type": "varchar"
                    },
                    {
                        "name": "Active/Lost",
                        "type": "varchar"
                    },
                    {
                        "name": "product_line_id",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "product_line_descr",
                        "type": "varchar"
                    },
                    {
                        "name": "folder_number",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "folder_name",
                        "type": "varchar"
                    },
                    {
                        "name": "master_client_number",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "master_client_name",
                        "type": "varchar"
                    },
                    {
                        "name": "control_group_name",
                        "type": "varchar"
                    },
                    {
                        "name": "control_group_number",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "mc_segment_descr",
                        "type": "varchar"
                    },
                    {
                        "name": "profitability",
                        "type": "varchar"
                    },
                    {
                        "name": "SEC_Descr",
                        "type": "varchar"
                    },
                    {
                        "name": "form_of_org",
                        "type": "varchar"
                    },
                    {
                        "name": "repeatable",
                        "type": "char"
                    },
                    {
                        "name": "extended_service",
                        "type": "char"
                    },
                    {
                        "name": "WagnerFlag1",
                        "type": "varchar"
                    },
                    {
                        "name": "WagnerFlag2",
                        "type": "varchar"
                    },
                    {
                        "name": "fl_function",
                        "type": "varchar"
                    },
                    {
                        "name": "fl_name",
                        "type": "varchar"
                    },
                    {
                        "name": "naics_code",
                        "type": "varchar"
                    },
                    {
                        "name": "naics_descr",
                        "type": "varchar"
                    },
                    {
                        "name": "pl1_employee_number",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "pl1_name",
                        "type": "varchar"
                    },
                    {
                        "name": "pl1_sub_function",
                        "type": "varchar"
                    },
                    {
                        "name": "pl2_employee_number",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "pl2_name",
                        "type": "varchar"
                    },
                    {
                        "name": "pl2_sub_function",
                        "type": "varchar"
                    },
                    {
                        "name": "date_acquired",
                        "type": "datetime",
                        "precision": 23,
                        "scale": 3
                    },
                    {
                        "name": "phone",
                        "type": "varchar"
                    },
                    {
                        "name": "email",
                        "type": "varchar"
                    },
                    {
                        "name": "city",
                        "type": "varchar"
                    },
                    {
                        "name": "subfunction",
                        "type": "varchar"
                    },
                    {
                        "name": "solution_set",
                        "type": "varchar"
                    },
                    {
                        "name": "capability_set",
                        "type": "varchar"
                    },
                    {
                        "name": "service_line_descr",
                        "type": "varchar"
                    },
                    {
                        "name": "LOB",
                        "type": "varchar"
                    },
                    {
                        "name": "Industry",
                        "type": "varchar"
                    },
                    {
                        "name": "Sector",
                        "type": "varchar"
                    },
                    {
                        "name": "Sub_Sector",
                        "type": "varchar"
                    },
                    {
                        "name": "csc_employee_number",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "csc_name",
                        "type": "varchar"
                    },
                    {
                        "name": "RL_office",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "RL_region",
                        "type": "varchar"
                    },
                    {
                        "name": "RL_market",
                        "type": "varchar"
                    },
                    {
                        "name": "RL_submarket",
                        "type": "varchar"
                    },
                    {
                        "name": "RL_msa",
                        "type": "varchar"
                    },
                    {
                        "name": "ZipRegion",
                        "type": "varchar"
                    },
                    {
                        "name": "ZipMarket",
                        "type": "varchar"
                    },
                    {
                        "name": "ZipSubMarket",
                        "type": "varchar"
                    },
                    {
                        "name": "ZipMsa",
                        "type": "varchar"
                    },
                    {
                        "name": "office_name",
                        "type": "varchar"
                    },
                    {
                        "name": "zipcode",
                        "type": "varchar"
                    },
                    {
                        "name": "state",
                        "type": "char"
                    },
                    {
                        "name": "period",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "TTM_CY_NET",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "TTM_CY_Gross",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "TTM_CY_Hours",
                        "type": "decimal",
                        "precision": 38,
                        "scale": 1
                    },
                    {
                        "name": "TTM_PY_NET",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "TTM_PY_Gross",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "TTM_PY_Hours",
                        "type": "decimal",
                        "precision": 38,
                        "scale": 1
                    },
                    {
                        "name": "FY_PY_NET",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "FY_PY_Gross",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "FY_PY_Hours",
                        "type": "decimal",
                        "precision": 38,
                        "scale": 1
                    },
                    {
                        "name": "FY_PY2_NET",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "FY_PY2_Gross",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "FY_PY2_Hours",
                        "type": "decimal",
                        "precision": 38,
                        "scale": 1
                    },
                    {
                        "name": "MO_CY_NET",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "MO_CY_Gross",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "MO_CY_Hours",
                        "type": "decimal",
                        "precision": 38,
                        "scale": 1
                    },
                    {
                        "name": "MO_PY_NET",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "MO_PY_Gross",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "MO_PY_Hours",
                        "type": "decimal",
                        "precision": 38,
                        "scale": 1
                    },
                    {
                        "name": "FYTD_CY_NET",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "FYTD_CY_Gross",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "FYTD_CY_Hours",
                        "type": "decimal",
                        "precision": 38,
                        "scale": 1
                    },
                    {
                        "name": "FYTD_PY_NET",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "FYTD_PY_Gross",
                        "type": "money",
                        "precision": 19,
                        "scale": 4
                    },
                    {
                        "name": "FYTD_PY_Hours",
                        "type": "decimal",
                        "precision": 38,
                        "scale": 1
                    },
                    {
                        "name": "Month",
                        "type": "nvarchar"
                    },
                    {
                        "name": "Channel",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "ZipOfficeNumber",
                        "type": "int",
                        "precision": 10
                    }
                ],
                "typeProperties": {
                    "schema": "rsm",
                    "table": "client_report_by_monthend_detail"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSynapseAnalytics1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/DestinationDataset_wn7')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSynapseAnalytics1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlDWTable",
                "schema": [],
                "typeProperties": {
                    "schema": "rsm.client_report_by_monthend_detail_full",
                    "table": "Azure Blob Storage file"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSynapseAnalytics1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/SourceDataset_wn7')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureBlobStorage1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobStorageLocation",
                        "fileName": "results1.rpt",
                        "folderPath": "Landing",
                        "container": "rsm"
                    },
                    "columnDelimiter": "\t",
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": []
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureBlobStorage1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/MAPSAzureSqlTable')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSQLMAPS",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Container"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSQLMAPS')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/CaseWareDBs')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorageGen2",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "Binary",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobFSLocation",
                        "folderPath": "Query/CurrentState/CaseWare",
                        "fileSystem": "rsm"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorageGen2')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/ProcessAzureAS MSI')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "UntilRefreshComplete",
                        "type": "Until",
                        "dependsOn": [
                            {
                                "activity": "FilterToCurrentRefresh",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@not(equals(activity('GetAzureASRefreshStatus').output.status,'inProgress'))",
                                "type": "Expression"
                            },
                            "activities": [
                                {
                                    "name": "GetAzureASRefreshStatus",
                                    "type": "WebActivity",
                                    "dependsOn": [
                                        {
                                            "activity": "Wait30Seconds",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "url": {
                                            "value": "@concat('https://',pipeline().parameters.Region,'.asazure.windows.net/servers/',pipeline().parameters.Server,'/models/',pipeline().parameters.DatabaseName,'/refreshes/',activity('FilterToCurrentRefresh').output.Value[0].refreshId)",
                                            "type": "Expression"
                                        },
                                        "method": "GET",
                                        "headers": {},
                                        "authentication": {
                                            "type": "MSI",
                                            "resource": "https://*.asazure.windows.net"
                                        }
                                    }
                                },
                                {
                                    "name": "Wait30Seconds",
                                    "type": "Wait",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "waitTimeInSeconds": 30
                                    }
                                }
                            ],
                            "timeout": "7.00:00:00"
                        }
                    },
                    {
                        "name": "StartProcessingAzureAS",
                        "type": "WebActivity",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "url": {
                                "value": "@concat('https://',pipeline().parameters.Region,'.asazure.windows.net/servers/',pipeline().parameters.Server,'/models/',pipeline().parameters.DatabaseName,'/refreshes')",
                                "type": "Expression"
                            },
                            "method": "POST",
                            "headers": {},
                            "body": {
                                "Type": "Full",
                                "CommitMode": "transactional",
                                "MaxParallelism": 10,
                                "RetryCount": 2
                            },
                            "authentication": {
                                "type": "MSI",
                                "resource": "https://*.asazure.windows.net"
                            }
                        }
                    },
                    {
                        "name": "IfFailed",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "UntilRefreshComplete",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(activity('GetAzureASRefreshStatus').output.status,'failed')",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "ThrowErrorOnFailure",
                                    "type": "WebActivity",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "url": {
                                            "value": "@string(activity('GetAzureASRefreshStatus').output)",
                                            "type": "Expression"
                                        },
                                        "method": "GET",
                                        "headers": {}
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "GetAzureASRefreshes",
                        "type": "WebActivity",
                        "dependsOn": [
                            {
                                "activity": "StartProcessingAzureAS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "url": {
                                "value": "@concat('https://',pipeline().parameters.Region,'.asazure.windows.net/servers/',pipeline().parameters.Server,'/models/',pipeline().parameters.DatabaseName,'/refreshes')",
                                "type": "Expression"
                            },
                            "method": "GET",
                            "headers": {},
                            "body": {
                                "Type": "Full",
                                "CommitMode": "transactional",
                                "MaxParallelism": 10,
                                "RetryCount": 2
                            },
                            "authentication": {
                                "type": "MSI",
                                "resource": "https://*.asazure.windows.net"
                            }
                        }
                    },
                    {
                        "name": "FilterToCurrentRefresh",
                        "type": "Filter",
                        "dependsOn": [
                            {
                                "activity": "GetAzureASRefreshes",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@json(activity('GetAzureASRefreshes').output.Response)",
                                "type": "Expression"
                            },
                            "condition": {
                                "value": "@greaterOrEquals(item().startTime,addseconds(activity('StartProcessingAzureAS').output.startTime,-30))",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "parameters": {
                    "TenantID": {
                        "type": "String",
                        "defaultValue": "687f51c3-0c5d-4905-84f8-97c683a5b9d1"
                    },
                    "SubscriptionID": {
                        "type": "String",
                        "defaultValue": "373f6263-8734-45c8-a9c3-ab48e22952ea"
                    },
                    "Region": {
                        "type": "String",
                        "defaultValue": "westus2"
                    },
                    "Server": {
                        "type": "String",
                        "defaultValue": "asazure://westus2.asazure.windows.net/dadevwus2mdsanalyticsax"
                    },
                    "DatabaseName": {
                        "type": "String",
                        "defaultValue": "Retail"
                    }
                },
                "folder": {
                    "name": "Azure AS"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:20Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/ResumeAzureAS MSI')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "IfAzureASPaused",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "CheckIfAzureASSuspended",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@not(equals('Succeeded',string(activity('CheckIfAzureASSuspended').output.properties.state)))",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "ResumeAzureAS",
                                    "type": "WebActivity",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "url": {
                                            "value": "@concat('https://management.azure.com/subscriptions/',pipeline().parameters.SubscriptionID,'/resourceGroups/',pipeline().parameters.ResourceGroup,'/providers/Microsoft.AnalysisServices/servers/',pipeline().parameters.Server,'/resume?api-version=2016-05-16')",
                                            "type": "Expression"
                                        },
                                        "method": "POST",
                                        "headers": {},
                                        "body": {
                                            "value": "@null",
                                            "type": "Expression"
                                        },
                                        "authentication": {
                                            "type": "MSI",
                                            "resource": "https://management.azure.com"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "CheckIfAzureASSuspended",
                        "type": "WebActivity",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "url": {
                                "value": "@concat('https://management.azure.com/subscriptions/',pipeline().parameters.SubscriptionID,'/resourceGroups/',pipeline().parameters.ResourceGroup,'/providers/Microsoft.AnalysisServices/servers/',pipeline().parameters.Server,'?api-version=2016-05-16')",
                                "type": "Expression"
                            },
                            "method": "GET",
                            "headers": {},
                            "authentication": {
                                "type": "MSI",
                                "resource": "https://management.azure.com"
                            }
                        }
                    },
                    {
                        "name": "UntilAzureASResumed",
                        "type": "Until",
                        "dependsOn": [
                            {
                                "activity": "IfAzureASPaused",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals('Succeeded',string(activity('CheckAzureASStatus').output.properties.state))",
                                "type": "Expression"
                            },
                            "activities": [
                                {
                                    "name": "CheckAzureASStatus",
                                    "type": "WebActivity",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "url": {
                                            "value": "@concat('https://management.azure.com/subscriptions/',pipeline().parameters.SubscriptionID,'/resourceGroups/',pipeline().parameters.ResourceGroup,'/providers/Microsoft.AnalysisServices/servers/',pipeline().parameters.Server,'?api-version=2016-05-16')",
                                            "type": "Expression"
                                        },
                                        "method": "GET",
                                        "headers": {},
                                        "authentication": {
                                            "type": "MSI",
                                            "resource": "https://management.azure.com"
                                        }
                                    }
                                }
                            ],
                            "timeout": "7.00:00:00"
                        }
                    }
                ],
                "parameters": {
                    "TenantID": {
                        "type": "String",
                        "defaultValue": "b7e05600-0037-4b59-b466-239dfcf89541"
                    },
                    "SubscriptionID": {
                        "type": "String",
                        "defaultValue": "a9736b54-71f3-4a19-bd5b-d3979b8ce04f"
                    },
                    "ResourceGroup": {
                        "type": "String",
                        "defaultValue": "da-dev-wus2-analytics-rg"
                    },
                    "Server": {
                        "type": "String",
                        "defaultValue": "dadevwus2analyticsaxlennr"
                    }
                },
                "folder": {
                    "name": "Azure AS"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:20Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/ResetMasterExecutionPlans')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspResetPipeLineExecutionList",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspResetPipeLineExecutionList",
                            "storedProcedureParameters": {
                                "PipeLineExecutionGroupName": {
                                    "value": "masterDatabricks",
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "uspResetNotebookExecutionList",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspResetNotebookExecutionList",
                            "storedProcedureParameters": {
                                "NotebookExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.ContainerName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    }
                ],
                "parameters": {
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "AX"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:21Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/MasterNotebookData001')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Log Start Event",
                        "description": "Log Start Event information.",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspLogEventNotebookStart",
                                "storedProcedureParameters": {
                                    "DataFactoryName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "NotebookName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookName",
                                            "type": "Expression"
                                        }
                                    },
                                    "NotebookStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "PipelineRunId": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().RunId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Log Success Event",
                        "description": "Log Success Event information.",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Master Notebook Execution",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventNotebookEnd",
                            "storedProcedureParameters": {
                                "NotebookExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('Log Start Event').output.firstRow.NotebookExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "NotebookName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "Log Failure Event",
                        "description": "Log Failure Event information.",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Master Notebook Execution",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventNotebookError",
                            "storedProcedureParameters": {
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Master Notebook Execution').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Master Notebook Execution').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('Log Start Event').output.firstRow.NotebookExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "Master Notebook Execution",
                        "type": "DatabricksNotebook",
                        "dependsOn": [
                            {
                                "activity": "Log Start Event",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.0:0:0",
                            "retry": 3,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": {
                                "value": "@concat(pipeline().parameters.NotebookSystemPath,'Master Notebook Execution')",
                                "type": "Expression"
                            },
                            "baseParameters": {
                                "notebookExecutionName": {
                                    "value": "@pipeline().parameters.NotebookName",
                                    "type": "Expression"
                                },
                                "NotebookSystemPath": {
                                    "value": "@pipeline().parameters.NotebookSystemPath",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureDatabricksData001",
                            "type": "LinkedServiceReference"
                        }
                    }
                ],
                "parameters": {
                    "NotebookName": {
                        "type": "String",
                        "defaultValue": "client000000002_Concurrent_Connections_Enrich_Publish"
                    },
                    "NotebookRunDateFolder": {
                        "type": "String"
                    },
                    "NotebookSystemPath": {
                        "type": "String",
                        "defaultValue": "/Retail/Publish/Framework/"
                    },
                    "NotebookExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "AX Enrich"
                    }
                },
                "folder": {
                    "name": "Databricks/Container"
                },
                "annotations": [
                    "@pipeline().parameters.NotebookExecutionGroupName"
                ],
                "lastPublishTime": "2020-12-31T18:49:21Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureDatabricksData001')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/MasterNotebookFramework')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Log Start Event",
                        "description": "Log Start Event information.",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspLogEventNotebookStart",
                                "storedProcedureParameters": {
                                    "DataFactoryName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "NotebookName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookName",
                                            "type": "Expression"
                                        }
                                    },
                                    "NotebookStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "PipelineRunId": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().RunId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Log Success Event",
                        "description": "Log Success Event information.",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Master Notebook Execution",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventNotebookEnd",
                            "storedProcedureParameters": {
                                "NotebookExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('Log Start Event').output.firstRow.NotebookExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "NotebookName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "Log Failure Event",
                        "description": "Log Failure Event information.",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Master Notebook Execution",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventNotebookError",
                            "storedProcedureParameters": {
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Master Notebook Execution').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Master Notebook Execution').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('Log Start Event').output.firstRow.NotebookExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "Master Notebook Execution",
                        "type": "DatabricksNotebook",
                        "dependsOn": [
                            {
                                "activity": "Log Start Event",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.0:0:0",
                            "retry": 3,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/Framework/Master Notebook Execution",
                            "baseParameters": {
                                "notebookExecutionName": {
                                    "value": "@pipeline().parameters.NotebookName",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureDatabricksFramework",
                            "type": "LinkedServiceReference"
                        }
                    }
                ],
                "parameters": {
                    "NotebookName": {
                        "type": "String",
                        "defaultValue": "Client000000001_Dataset1_Ingest"
                    },
                    "NotebookRunDateFolder": {
                        "type": "String"
                    },
                    "NotebookSystemPath": {
                        "type": "String",
                        "defaultValue": "Framework/"
                    },
                    "NotebookExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Client000000001 Ingest"
                    }
                },
                "folder": {
                    "name": "Databricks/Framework"
                },
                "annotations": [
                    "@pipeline().parameters.NotebookExecutionGroupName"
                ],
                "lastPublishTime": "2020-12-31T18:49:21Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureDatabricksFramework')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/LoopMasterNotebookFramework')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspGetContainerNBExecutionList",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventPipeLineStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspGetNotebookExecutionList",
                                "storedProcedureParameters": {
                                    "NotebookExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "Databricks Notebook Loop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetContainerNBExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetContainerNBExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 16,
                            "activities": [
                                {
                                    "name": "Exec MasterNotebook",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "MasterNotebookFramework",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "NotebookRunDateFolder": {
                                                "value": "@pipeline().parameters.NotebookRunDateFolder",
                                                "type": "Expression"
                                            },
                                            "NotebookExecutionGroupName": {
                                                "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "NotebookSystemPath": "Framework/",
                                            "NotebookName": {
                                                "value": "@item().NotebookName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineStart",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspLogEventPipeLineStart",
                                "storedProcedureParameters": {
                                    "DataFactoryName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentPipeLineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "0",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineRunId": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().RunId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerID": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineEnd",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Databricks Notebook Loop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventPipeLineEnd",
                            "storedProcedureParameters": {
                                "PipeLineExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "PipeLineExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventPipeLineStart').output.firstRow.PipeLineExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "PipeLineName": {
                                    "value": {
                                        "value": "@pipeline().Pipeline",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "PipeLineStatus": {
                                    "value": {
                                        "value": "SUCCEEDED",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    }
                ],
                "parameters": {
                    "NotebookRunDateFolder": {
                        "type": "String"
                    },
                    "NotebookSystemPath": {
                        "type": "String",
                        "defaultValue": "Framework/"
                    },
                    "NotebookExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Retail Ingest"
                    },
                    "NotebookName": {
                        "type": "string",
                        "defaultValue": "Master Notebook Execution"
                    }
                },
                "folder": {
                    "name": "Databricks/Framework"
                },
                "annotations": [
                    "@pipeline().parameters.NotebookExecutionGroupName"
                ],
                "lastPublishTime": "2020-12-31T18:49:21Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/pipelines/MasterNotebookFramework')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/LoopMasterNotebookData001')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspGetContainerNBExecutionList",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventPipeLineStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspGetNotebookExecutionList",
                                "storedProcedureParameters": {
                                    "NotebookExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "Databricks Notebook Loop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetContainerNBExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetContainerNBExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 16,
                            "activities": [
                                {
                                    "name": "Exec MasterNotebook",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "MasterNotebookData001",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "NotebookRunDateFolder": {
                                                "value": "@pipeline().parameters.NotebookRunDateFolder",
                                                "type": "Expression"
                                            },
                                            "NotebookExecutionGroupName": {
                                                "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "NotebookSystemPath": {
                                                "value": "@pipeline().parameters.NotebookSystemPath",
                                                "type": "Expression"
                                            },
                                            "NotebookName": {
                                                "value": "@item().NotebookName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineStart",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspLogEventPipeLineStart",
                                "storedProcedureParameters": {
                                    "DataFactoryName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentPipeLineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "0",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineRunId": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().RunId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerID": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineEnd",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Databricks Notebook Loop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventPipeLineEnd",
                            "storedProcedureParameters": {
                                "PipeLineExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "PipeLineExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventPipeLineStart').output.firstRow.PipeLineExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "PipeLineName": {
                                    "value": {
                                        "value": "@pipeline().Pipeline",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "PipeLineStatus": {
                                    "value": {
                                        "value": "SUCCEEDED",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    }
                ],
                "parameters": {
                    "NotebookRunDateFolder": {
                        "type": "String"
                    },
                    "NotebookSystemPath": {
                        "type": "String",
                        "defaultValue": "/rsm/Publisher/Framework/"
                    },
                    "NotebookExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "TSA Enrich"
                    },
                    "NotebookName": {
                        "type": "string",
                        "defaultValue": "Master Notebook Execution"
                    }
                },
                "folder": {
                    "name": "Databricks/Container"
                },
                "annotations": [
                    "@pipeline().parameters.NotebookExecutionGroupName"
                ],
                "lastPublishTime": "2021-01-22T21:45:30Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/pipelines/MasterNotebookData001')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/LatestRawFile')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Log Start Event",
                        "description": "Log Start Event information.",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspLogEventNotebookStart",
                                "storedProcedureParameters": {
                                    "DataFactoryName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "NotebookName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookName",
                                            "type": "Expression"
                                        }
                                    },
                                    "NotebookStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "PipelineRunId": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().RunId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipelineTriggerType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspGetNotebookADLS",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Log Start Event",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspGetNotebookADLS",
                                "storedProcedureParameters": {
                                    "NotebookName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookName",
                                            "type": "Expression"
                                        }
                                    },
                                    "Rundatefolder": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookRunDateFolder",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Log Success Event",
                        "description": "Log Success Event information.",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Latest Raw File",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventNotebookEnd",
                            "storedProcedureParameters": {
                                "NotebookExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('Log Start Event').output.firstRow.NotebookExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "NotebookName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "Log Failure Event",
                        "description": "Log Failure Event information.",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Latest Raw File",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventNotebookError",
                            "storedProcedureParameters": {
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Latest Raw File').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Latest Raw File').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "NotebookExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('Log Start Event').output.firstRow.NotebookExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.NotebookName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "Latest Raw File",
                        "type": "DatabricksNotebook",
                        "dependsOn": [
                            {
                                "activity": "Get Notebook Parameters",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/Framework/Master Notebook Execution",
                            "baseParameters": {
                                "rawDataPath": {
                                    "value": "@activity('Get Notebook Parameters').output.FirstRow.rawDataPath",
                                    "type": "Expression"
                                },
                                "schemaName": {
                                    "value": "@activity('Get Notebook Parameters').output.FirstRow.schemaName",
                                    "type": "Expression"
                                },
                                "tableName": {
                                    "value": "@activity('Get Notebook Parameters').output.firstrow.tableName",
                                    "type": "Expression"
                                },
                                "numPartitions": "8"
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureDatabricksFramework",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "Get Notebook Parameters",
                        "description": "Retrieve Notebook Parameters for a given Notebook.",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspGetNotebookADLS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetNotebookParameters]",
                                "storedProcedureParameters": {
                                    "NotebookName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    }
                ],
                "parameters": {
                    "NotebookName": {
                        "type": "String",
                        "defaultValue": "Master Notebook Execution"
                    },
                    "NotebookParameterValue": {
                        "type": "String",
                        "defaultValue": "client000000001_Definitive_Ingest"
                    },
                    "NotebookRunDateFolder": {
                        "type": "String"
                    },
                    "NotebookExecutionGroupName": {
                        "type": "String",
                        "defaultValue": "client000000001 Definitive Ingest"
                    },
                    "NotebookSystemPath": {
                        "type": "String",
                        "defaultValue": "Framework/"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:22Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureDatabricksFramework')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/LoopLatestToRawFile')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspGetNoteBookExecutionList",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventPipeLineStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspGetNoteBookExecutionList",
                                "storedProcedureParameters": {
                                    "NotebookExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "Databricks Notebook Loop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetNoteBookExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetNoteBookExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 5,
                            "activities": [
                                {
                                    "name": "Exec latestRawFile",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "LatestRawFile",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "NotebookName": {
                                                "value": "@item().Notebookname",
                                                "type": "Expression"
                                            },
                                            "NotebookParameterValue": {
                                                "value": "@item().NotebookParameterValue",
                                                "type": "Expression"
                                            },
                                            "NotebookRunDateFolder": {
                                                "value": "@pipeline().parameters.NotebookRunDateFolder",
                                                "type": "Expression"
                                            },
                                            "NotebookExecutionGroupName": {
                                                "value": "@pipeline().parameters.NotebookExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "NotebookSystemPath": "Prism/BinService/"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineStart",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlSource",
                                "sqlReaderStoredProcedureName": "uspLogEventPipeLineStart",
                                "storedProcedureParameters": {
                                    "DataFactoryName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentPipeLineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "0",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineRunId": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().RunId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerID": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    },
                                    "PipeLineTriggerType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineEnd",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Databricks Notebook Loop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventPipeLineEnd",
                            "storedProcedureParameters": {
                                "PipeLineExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.PipeLineExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "PipeLineExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventPipeLineStart').output.firstRow.PipeLineExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "PipeLineName": {
                                    "value": {
                                        "value": "@pipeline().Pipeline",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "PipeLineStatus": {
                                    "value": {
                                        "value": "SUCCEEDED",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    }
                ],
                "parameters": {
                    "NotebookExecutionGroupName": {
                        "type": "String",
                        "defaultValue": "Notebook Binservice LatestRaw"
                    },
                    "PipeLineExecutionGroupName": {
                        "type": "String",
                        "defaultValue": "masterPrism"
                    },
                    "NotebookRunDateFolder": {
                        "type": "String"
                    },
                    "NotebookSystemPath": {
                        "type": "String",
                        "defaultValue": "Prism/BinService/"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:23Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/pipelines/LatestRawFile')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/NeuDWFRCopyDataPipeline_File')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspLogEventCopyActivityStart",
                        "description": "Logs the start of the pipeline to SQL Server framework database",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspLogEventCopyActivityStart]",
                                "storedProcedureParameters": {
                                    "CopyActivityCreatedBy": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityCreationDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "MachineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "MasterPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ParentCopyActivityExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ServerExecutionId": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "UserName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventCopyActivityEnd",
                        "description": "Log the end of the successful execution of the steps in the pipeline ",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[dbo].[uspLogEventCopyActivityEnd]",
                            "storedProcedureParameters": {
                                "CopyActivityCopyDuration": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.copyDuration",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "CopyActivityDataRead": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.dataRead",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityDataWrite": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.dataWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityFilesRead": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivityFilesWrite": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.filesWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsCopied": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.rowsCopied",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsSkipped": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivitySinkName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                },
                                "CopyActivityThroughput": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.throughput",
                                        "type": "Expression"
                                    },
                                    "type": "Double"
                                },
                                "CopyActivityUsedCloudDataMovementUnits": {
                                    "value": "0",
                                    "type": "Int32"
                                },
                                "CopyActivityUsedParallelCopies": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.usedParallelCopies",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineError",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SetActivityError Generic",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventCopyActivityError",
                            "storedProcedureParameters": {
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "SetActivityError Generic",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "Copy Data Activity Error"
                        }
                    },
                    {
                        "name": "uspGetCopyActivitySinkFileToADLS",
                        "description": "Get list of copy activities.",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivitySinkFileToADLS]",
                                "storedProcedureParameters": {
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Copy Landing File to Raw Json",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkFileToADLS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureBlobFSSource",
                                "recursive": true
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobFSWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false,
                            "dataIntegrationUnits": 0
                        },
                        "inputs": [
                            {
                                "referenceName": "AzureDataLakeStoreFile",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "AzureDataLakeStoreFile_Json",
                                "type": "DatasetReference",
                                "parameters": {
                                    "FilePath": {
                                        "value": "@concat(pipeline().parameters.ContainerName,activity('uspGetCopyActivitySinkFileToADLS').output.firstRow.CopyActivityDataADLSFolderPath)\n",
                                        "type": "Expression"
                                    },
                                    "FileName": {
                                        "value": "@activity('uspGetCopyActivitySinkFileToADLS').output.firstRow.CopyActivityDataADLSFileName\n",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkFileToADLS",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    },
                    {
                        "name": "SetActivityError Copy Landing File to Raw Json",
                        "description": "",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    }
                ],
                "parameters": {
                    "PipelineExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Turnover Copy Process"
                    },
                    "ParentPipeLineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivitySinkName": {
                        "type": "string",
                        "defaultValue": "Sink_Table_name"
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Turnover Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "cgs"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:23Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/datasets/AzureDataLakeStoreFile')]",
                "[concat(variables('factoryId'), '/datasets/AzureDataLakeStoreFile_Json')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/NeuDWFRCopyDataPipeline_API')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspLogEventCopyActivityStart",
                        "description": "Logs the start of the pipeline to SQL Server framework database",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspLogEventCopyActivityStart]",
                                "storedProcedureParameters": {
                                    "CopyActivityCreatedBy": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityCreationDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "MachineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "MasterPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ParentCopyActivityExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ServerExecutionId": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "UserName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventCopyActivityEnd",
                        "description": "Log the end of the successful execution of the steps in the pipeline ",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[dbo].[uspLogEventCopyActivityEnd]",
                            "storedProcedureParameters": {
                                "CopyActivityCopyDuration": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.copyDuration",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "CopyActivityDataRead": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.dataRead",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityDataWrite": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.dataWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityFilesRead": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivityFilesWrite": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.filesWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsCopied": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.rowsCopied",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsSkipped": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivitySinkName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                },
                                "CopyActivityThroughput": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.throughput",
                                        "type": "Expression"
                                    },
                                    "type": "Double"
                                },
                                "CopyActivityUsedCloudDataMovementUnits": {
                                    "value": "0",
                                    "type": "Int32"
                                },
                                "CopyActivityUsedParallelCopies": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.usedParallelCopies",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineError",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SetActivityError Generic",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventCopyActivityError",
                            "storedProcedureParameters": {
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "SetActivityError Generic",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "Copy Data Activity Error"
                        }
                    },
                    {
                        "name": "uspGetCopyActivitySinkAPIToADLS",
                        "description": "Get list of copy activities.",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivitySinkAPIToADLS]",
                                "storedProcedureParameters": {
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Copy Landing File to Raw Json",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkAPIToADLS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureBlobFSSource",
                                "recursive": true
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobFSWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false,
                            "dataIntegrationUnits": 0
                        },
                        "inputs": [
                            {
                                "referenceName": "AzureDataLakeStoreFile_Txt",
                                "type": "DatasetReference",
                                "parameters": {
                                    "FilePath": "placeholder",
                                    "FileName": "placeholder"
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "AzureDataLakeStoreFile_Json",
                                "type": "DatasetReference",
                                "parameters": {
                                    "FilePath": {
                                        "value": "@concat(pipeline().parameters.ContainerName,activity('uspGetCopyActivitySinkAPIToADLS').output.firstRow.CopyActivityDataADLSFolderPath)\n",
                                        "type": "Expression"
                                    },
                                    "FileName": {
                                        "value": "@activity('uspGetCopyActivitySinkAPIToADLS').output.firstRow.CopyActivityDataADLSFileName\n",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkAPIToADLS",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    },
                    {
                        "name": "SetActivityError Copy Landing File to Raw Json",
                        "description": "",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkAPIToADLS"
                        }
                    },
                    {
                        "name": "Get_API_Secret",
                        "type": "WebActivity",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkAPIToADLS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": true,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "url": {
                                "value": "@{activity('uspGetCopyActivitySinkAPIToADLS').output.firstRow.CopyActivityDataAPIKeyVaultSecretURL}",
                                "type": "Expression"
                            },
                            "method": "GET",
                            "headers": {},
                            "authentication": {
                                "type": "MSI",
                                "resource": "https://vault.azure.net"
                            }
                        }
                    },
                    {
                        "name": "Set_API_PW",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Get_API_Secret",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "API_Password",
                            "value": {
                                "value": "@activity('Get_API_Secret').output.value",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Get_Access_Token",
                        "description": "Use this Web activity to get bearer token",
                        "type": "WebActivity",
                        "dependsOn": [
                            {
                                "activity": "Set_API_PW",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": true
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "url": {
                                "value": "@{activity('uspGetCopyActivitySinkAPIToADLS').output.firstRow.CopyActivityDataAPIAuthURLL}",
                                "type": "Expression"
                            },
                            "connectVia": {
                                "referenceName": "SelfHostedIntegrationRuntime",
                                "type": "IntegrationRuntimeReference"
                            },
                            "method": "POST",
                            "headers": {
                                "Content-Type": "application/json"
                            },
                            "body": {
                                "value": "{\n   \"username\":\"api\",\n   \"password\": @{variables('API_Password')}\n}",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "parameters": {
                    "PipelineExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Turnover Copy Process"
                    },
                    "ParentPipeLineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivitySinkName": {
                        "type": "string",
                        "defaultValue": "Sink_Table_name"
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Turnover Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "cgs"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    },
                    "API_Password": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:23Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/datasets/AzureDataLakeStoreFile_Txt')]",
                "[concat(variables('factoryId'), '/datasets/AzureDataLakeStoreFile_Json')]",
                "[concat(variables('factoryId'), '/integrationRuntimes/SelfHostedIntegrationRuntime')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/NeuDWFRCopyDataPipelineLoop_API')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "CopyDataActivityLoop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivityExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetCopyActivityExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 8,
                            "activities": [
                                {
                                    "name": "Exec Copy",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "NeuDWFRCopyDataPipeline_File",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "PipelineExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "ParentPipeLineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "CopyActivitySinkName": {
                                                "value": "@item().CopyActivitySinkName",
                                                "type": "Expression"
                                            },
                                            "CopyActivityExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "MasterPipelineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@item().ContainerName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspGetCopyActivityExecutionList",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivityExecutionList]",
                                "storedProcedureParameters": {
                                    "CopyActivityExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "ResetCopyLoop",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "CopyDataActivityLoop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.ResetOnCompletion,'Yes')",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "uspResetCopyActivityExecutionList",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[dbo].[uspResetCopyActivityExecutionList]",
                                        "storedProcedureParameters": {
                                            "SystemName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "AzureSqlDatabase",
                                        "type": "LinkedServiceReference"
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "SystemExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Turnover Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Turnover Copy Process"
                    },
                    "ResetOnCompletion": {
                        "type": "string",
                        "defaultValue": "Yes"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:23Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/pipelines/NeuDWFRCopyDataPipeline_File')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/NeuDWFRCopyDataPipelineLoop_File')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "CopyDataActivityLoop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivityExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetCopyActivityExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 8,
                            "activities": [
                                {
                                    "name": "Exec Copy",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "NeuDWFRCopyDataPipeline_File",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "PipelineExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "ParentPipeLineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "CopyActivitySinkName": {
                                                "value": "@item().CopyActivitySinkName",
                                                "type": "Expression"
                                            },
                                            "CopyActivityExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "MasterPipelineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@item().ContainerName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspGetCopyActivityExecutionList",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivityExecutionList]",
                                "storedProcedureParameters": {
                                    "CopyActivityExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "ResetCopyLoop",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "CopyDataActivityLoop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.ResetOnCompletion,'Yes')",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "uspResetCopyActivityExecutionList",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[dbo].[uspResetCopyActivityExecutionList]",
                                        "storedProcedureParameters": {
                                            "SystemName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "AzureSqlDatabase",
                                        "type": "LinkedServiceReference"
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "SystemExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Turnover Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "Turnover Copy Process"
                    },
                    "ResetOnCompletion": {
                        "type": "string",
                        "defaultValue": "Yes"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:23Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/pipelines/NeuDWFRCopyDataPipeline_File')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/NeuDWFRCopyDataPipeline_SQL')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspLogEventCopyActivityStart",
                        "description": "Logs the start of the pipeline to SQL Server framework database",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspLogEventCopyActivityStart]",
                                "storedProcedureParameters": {
                                    "CopyActivityCreatedBy": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityCreationDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "MachineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "MasterPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentCopyActivityExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ServerExecutionId": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "UserName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventCopyActivityEnd",
                        "description": "Log the end of the successful execution of the steps in the pipeline ",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy Sink sql query to adls",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[dbo].[uspLogEventCopyActivityEnd]",
                            "storedProcedureParameters": {
                                "CopyActivityCopyDuration": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.copyDuration",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "CopyActivityDataRead": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.dataRead",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityDataWrite": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.dataWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityFilesRead": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivityFilesWrite": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.filesWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsCopied": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.rowsCopied",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsSkipped": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivitySinkName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                },
                                "CopyActivityThroughput": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.throughput",
                                        "type": "Expression"
                                    },
                                    "type": "Double"
                                },
                                "CopyActivityUsedCloudDataMovementUnits": {
                                    "value": "0",
                                    "type": "Int32"
                                },
                                "CopyActivityUsedParallelCopies": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.usedParallelCopies",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineError",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SetActivityError Generic",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError Copy sink sql query to adls",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventCopyActivityError",
                            "storedProcedureParameters": {
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "SetActivityError Generic",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "Copy Data Activity Error"
                        }
                    },
                    {
                        "name": "uspGetCopyActivitySinkSQLToADLS",
                        "description": "Get list of copy activities.",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivitySinkSQLToADLS]",
                                "storedProcedureParameters": {
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Copy Sink sql query to adls",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderQuery": {
                                    "value": "@activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataSQLScript",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobFSWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false,
                            "dataIntegrationUnits": 0
                        },
                        "inputs": [
                            {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "AzureDataLakeStoreFile_Json",
                                "type": "DatasetReference",
                                "parameters": {
                                    "FilePath": {
                                        "value": "@concat(pipeline().parameters.ContainerName,activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataADLSFolderPath)\n",
                                        "type": "Expression"
                                    },
                                    "FileName": {
                                        "value": "@activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataADLSFileName\n",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    },
                    {
                        "name": "SetActivityError Copy sink sql query to adls",
                        "description": "",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Copy Sink sql query to adls",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    }
                ],
                "parameters": {
                    "PipelineExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "APS Copy Process"
                    },
                    "ParentPipeLineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivitySinkName": {
                        "type": "string",
                        "defaultValue": "APS_T_Dim_Product"
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "APS Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "cgs"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [
                    "@pipeline().parameters.PipelineExecutionGroupName",
                    "@pipeline().parameters.CopyActivitySinkName"
                ],
                "lastPublishTime": "2020-12-31T18:49:24Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/datasets/AzureDataLakeStoreFile_Json')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/NeuDWFRCopyDataPipelineLoop_SQL')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "CopyDataActivityLoop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivityExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetCopyActivityExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 8,
                            "activities": [
                                {
                                    "name": "Exec Copy",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "NeuDWFRCopyDataPipeline_SQL",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "PipelineExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "ParentPipeLineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "CopyActivitySinkName": {
                                                "value": "@item().CopyActivitySinkName",
                                                "type": "Expression"
                                            },
                                            "CopyActivityExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "MasterPipelineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@item().ContainerName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspGetCopyActivityExecutionList",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivityExecutionList]",
                                "storedProcedureParameters": {
                                    "CopyActivityExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "ResetCopyLoop",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "CopyDataActivityLoop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.ResetOnCompletion,'Yes')",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "uspResetCopyActivityExecutionList",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[dbo].[uspResetCopyActivityExecutionList]",
                                        "storedProcedureParameters": {
                                            "SystemName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "AzureSqlDatabase",
                                        "type": "LinkedServiceReference"
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "SystemExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "AX Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "AX Copy Process"
                    },
                    "ResetOnCompletion": {
                        "type": "string",
                        "defaultValue": "Yes"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "Framework"
                },
                "annotations": [],
                "lastPublishTime": "2020-12-31T18:49:24Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/pipelines/NeuDWFRCopyDataPipeline_SQL')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TSACopyDataPipeline_SQL')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspLogEventCopyActivityStart",
                        "description": "Logs the start of the pipeline to SQL Server framework database",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspLogEventCopyActivityStart]",
                                "storedProcedureParameters": {
                                    "CopyActivityCreatedBy": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityCreationDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "MachineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "MasterPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentCopyActivityExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ServerExecutionId": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "UserName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventCopyActivityEnd",
                        "description": "Log the end of the successful execution of the steps in the pipeline ",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy Sink sql query to adls",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[dbo].[uspLogEventCopyActivityEnd]",
                            "storedProcedureParameters": {
                                "CopyActivityCopyDuration": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.copyDuration",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "CopyActivityDataRead": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.dataRead",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityDataWrite": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.dataWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityFilesRead": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivityFilesWrite": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.filesWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsCopied": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.rowsCopied",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsSkipped": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivitySinkName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                },
                                "CopyActivityThroughput": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.throughput",
                                        "type": "Expression"
                                    },
                                    "type": "Double"
                                },
                                "CopyActivityUsedCloudDataMovementUnits": {
                                    "value": "0",
                                    "type": "Int32"
                                },
                                "CopyActivityUsedParallelCopies": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.usedParallelCopies",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineError",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SetActivityError Generic",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError Copy sink sql query to adls",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventCopyActivityError",
                            "storedProcedureParameters": {
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "SetActivityError Generic",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "Copy Data Activity Error"
                        }
                    },
                    {
                        "name": "uspGetCopyActivitySinkSQLToADLS",
                        "description": "Get list of copy activities.",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivitySinkSQLToADLS]",
                                "storedProcedureParameters": {
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Copy Sink sql query to adls",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlMISource",
                                "sqlReaderQuery": {
                                    "value": "@activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataSQLScript",
                                    "type": "Expression"
                                },
                                "partitionOption": "None"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobFSWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false,
                            "dataIntegrationUnits": 0
                        },
                        "inputs": [
                            {
                                "referenceName": "TSASQLTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "AzureDataLakeStoreFile_Json",
                                "type": "DatasetReference",
                                "parameters": {
                                    "FilePath": {
                                        "value": "@concat(pipeline().parameters.ContainerName,activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataADLSFolderPath)\n",
                                        "type": "Expression"
                                    },
                                    "FileName": {
                                        "value": "@activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataADLSFileName\n",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    },
                    {
                        "name": "SetActivityError Copy sink sql query to adls",
                        "description": "",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Copy Sink sql query to adls",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    }
                ],
                "parameters": {
                    "PipelineExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "APS Copy Process"
                    },
                    "ParentPipeLineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivitySinkName": {
                        "type": "string",
                        "defaultValue": "APS_T_Dim_Product"
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "APS Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "cgs"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "TSACopyToDataLake"
                },
                "annotations": [
                    "@pipeline().parameters.PipelineExecutionGroupName",
                    "@pipeline().parameters.CopyActivitySinkName"
                ],
                "lastPublishTime": "2021-01-22T00:41:04Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/datasets/TSASQLTable')]",
                "[concat(variables('factoryId'), '/datasets/AzureDataLakeStoreFile_Json')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TSACopyDataPipelineLoop_SQL')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "CopyDataActivityLoop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivityExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetCopyActivityExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 8,
                            "activities": [
                                {
                                    "name": "Exec Copy",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "TSACopyDataPipeline_SQL",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "PipelineExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "ParentPipeLineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "CopyActivitySinkName": {
                                                "value": "@item().CopyActivitySinkName",
                                                "type": "Expression"
                                            },
                                            "CopyActivityExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "MasterPipelineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@item().ContainerName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspGetCopyActivityExecutionList",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivityExecutionList]",
                                "storedProcedureParameters": {
                                    "CopyActivityExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "ResetCopyLoop",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "CopyDataActivityLoop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.ResetOnCompletion,'Yes')",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "uspResetCopyActivityExecutionList",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[dbo].[uspResetCopyActivityExecutionList]",
                                        "storedProcedureParameters": {
                                            "SystemName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "AzureSqlDatabase",
                                        "type": "LinkedServiceReference"
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "SystemExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "TSA Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "TSA Copy Process"
                    },
                    "ResetOnCompletion": {
                        "type": "string",
                        "defaultValue": "Yes"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "TSACopyToDataLake"
                },
                "annotations": [],
                "lastPublishTime": "2021-01-22T01:51:55Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/pipelines/TSACopyDataPipeline_SQL')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TSACopyAndIngest')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "ResetMasterExecutionPlans",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "TSA"
                            }
                        }
                    },
                    {
                        "name": "TSA Copy",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "TSACopyDataPipelineLoop_SQL",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "TSA Ingest",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "TSA Copy",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookFramework",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "TSA Ingest"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "SourceCopyAndIngest"
                },
                "annotations": [],
                "lastPublishTime": "2021-01-22T00:39:59Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/TSACopyDataPipelineLoop_SQL')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookFramework')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TSAProcessing')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "ResetMasterExecutionPlans",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "TSA"
                            }
                        }
                    },
                    {
                        "name": "Copy",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "TSACopyDataPipelineLoop_SQL",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "Ingest",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Copy",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookFramework",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "TSA Ingest"
                            }
                        }
                    },
                    {
                        "name": "Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Ingest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "Sanction",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Enrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "TSA Sanction"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "TSAProcessing"
                },
                "annotations": [],
                "lastPublishTime": "2021-01-23T23:57:33Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/TSACopyDataPipelineLoop_SQL')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookFramework')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookData001')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TSAProcessing_RollingWindow')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "ResetMasterExecutionPlans",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "TSA_Rolling"
                            }
                        }
                    },
                    {
                        "name": "Copy",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "TSACopyDataPipelineLoop_SQL",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "SystemExecutionGroupName": "TSA_Rolling Copy Process",
                                "CopyActivityExecutionGroupName": "TSA_Rolling Copy Process"
                            }
                        }
                    },
                    {
                        "name": "Ingest",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Copy",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookFramework",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "TSA_Rolling Ingest"
                            }
                        }
                    },
                    {
                        "name": "Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Ingest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "TSA_Rolling Enrich"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "TSAProcessing"
                },
                "annotations": [],
                "lastPublishTime": "2021-01-27T18:17:50Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/TSACopyDataPipelineLoop_SQL')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookFramework')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookData001')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/CopyCaseware_dbf_fpt')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "CaseWareCopyDataPipelineLoop_File",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "CaseWareCopyDataPipelineLoop_File",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    }
                ],
                "folder": {
                    "name": "CaseWareCopyToDataLake"
                },
                "annotations": [],
                "lastPublishTime": "2021-04-30T17:31:27Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/CaseWareCopyDataPipelineLoop_File')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/CaseWareCopyDataPipeline_File')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspLogEventCopyActivityStart",
                        "description": "Logs the start of the pipeline to SQL Server framework database",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspLogEventCopyActivityStart]",
                                "storedProcedureParameters": {
                                    "CopyActivityCreatedBy": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityCreationDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "MachineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "MasterPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ParentCopyActivityExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ServerExecutionId": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "UserName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventCopyActivityEnd",
                        "description": "Log the end of the successful execution of the steps in the pipeline ",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[dbo].[uspLogEventCopyActivityEnd]",
                            "storedProcedureParameters": {
                                "CopyActivityCopyDuration": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.copyDuration",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "CopyActivityDataRead": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.dataRead",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityDataWrite": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.dataWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityFilesRead": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.filesRead",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityFilesWrite": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.filesWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsCopied": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivityRowsSkipped": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivitySinkName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                },
                                "CopyActivityThroughput": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.throughput",
                                        "type": "Expression"
                                    },
                                    "type": "Double"
                                },
                                "CopyActivityUsedCloudDataMovementUnits": {
                                    "value": "0",
                                    "type": "Int32"
                                },
                                "CopyActivityUsedParallelCopies": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').output.usedParallelCopies",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineError",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SetActivityError Generic",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventCopyActivityError",
                            "storedProcedureParameters": {
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Copy Landing File to Raw Json').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "SetActivityError Generic",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "Copy Data Activity Error"
                        }
                    },
                    {
                        "name": "uspGetCopyActivitySinkFileToADLS",
                        "description": "Get list of copy activities.",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivitySinkFileToADLS]",
                                "storedProcedureParameters": {
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkFileToADLS",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    },
                    {
                        "name": "SetActivityError Copy Landing File to Raw Json",
                        "description": "",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Copy Landing File to Raw Json",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    }
                ],
                "parameters": {
                    "PipelineExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "CaseWare Copy Process"
                    },
                    "ParentPipeLineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivitySinkName": {
                        "type": "string",
                        "defaultValue": "Sink_Table_name"
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "CaseWare Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "cgs"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "CaseWareCopyToDataLake"
                },
                "annotations": [],
                "lastPublishTime": "2021-04-30T17:24:39Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/datasets/AzureDataLakeStoreLanding_Binary')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/CaseWareCopyDataPipelineLoop_File')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "CopyDataActivityLoop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivityExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetCopyActivityExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 8,
                            "activities": [
                                {
                                    "name": "Exec Copy",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "CaseWareCopyDataPipeline_File",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "PipelineExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "ParentPipeLineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "CopyActivitySinkName": {
                                                "value": "@item().CopyActivitySinkName",
                                                "type": "Expression"
                                            },
                                            "CopyActivityExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "MasterPipelineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@item().ContainerName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspGetCopyActivityExecutionList",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivityExecutionList]",
                                "storedProcedureParameters": {
                                    "CopyActivityExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "ResetCopyLoop",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "CopyDataActivityLoop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.ResetOnCompletion,'Yes')",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "uspResetCopyActivityExecutionList",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[dbo].[uspResetCopyActivityExecutionList]",
                                        "storedProcedureParameters": {
                                            "SystemName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "AzureSqlDatabase",
                                        "type": "LinkedServiceReference"
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "SystemExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "CaseWare Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "CaseWare Copy Process"
                    },
                    "ResetOnCompletion": {
                        "type": "string",
                        "defaultValue": "Yes"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "CaseWareCopyToDataLake"
                },
                "annotations": [],
                "lastPublishTime": "2021-04-30T16:47:56Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/pipelines/CaseWareCopyDataPipeline_File')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/MAPSCopyDataPipelineLoop_SQL')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "CopyDataActivityLoop",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivityExecutionList",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('uspGetCopyActivityExecutionList').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 8,
                            "activities": [
                                {
                                    "name": "Exec Copy",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "MAPSCopyDataPipeline_SQL",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "PipelineExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "ParentPipeLineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "CopyActivitySinkName": {
                                                "value": "@item().CopyActivitySinkName",
                                                "type": "Expression"
                                            },
                                            "CopyActivityExecutionGroupName": {
                                                "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                "type": "Expression"
                                            },
                                            "MasterPipelineExecutionLogKey": {
                                                "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@item().ContainerName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "uspGetCopyActivityExecutionList",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivityExecutionList]",
                                "storedProcedureParameters": {
                                    "CopyActivityExecutionGroupName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "ResetCopyLoop",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "CopyDataActivityLoop",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.ResetOnCompletion,'Yes')",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "uspResetCopyActivityExecutionList",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[dbo].[uspResetCopyActivityExecutionList]",
                                        "storedProcedureParameters": {
                                            "SystemName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "AzureSqlDatabase",
                                        "type": "LinkedServiceReference"
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "SystemExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "MAPS Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "MAPS Copy Process"
                    },
                    "ResetOnCompletion": {
                        "type": "string",
                        "defaultValue": "Yes"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "MAPSCopyToDataLake"
                },
                "annotations": [],
                "lastPublishTime": "2021-05-10T22:55:24Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/pipelines/MAPSCopyDataPipeline_SQL')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/MAPSCopyDataPipeline_SQL')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "uspLogEventCopyActivityStart",
                        "description": "Logs the start of the pipeline to SQL Server framework database",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspLogEventCopyActivityStart]",
                                "storedProcedureParameters": {
                                    "CopyActivityCreatedBy": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().Pipeline",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityCreationDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityStartDate": {
                                        "type": "DateTime",
                                        "value": {
                                            "value": "@utcnow()",
                                            "type": "Expression"
                                        }
                                    },
                                    "CopyActivityTriggerID": {
                                        "type": "Guid",
                                        "value": {
                                            "value": "@pipeline().TriggerId",
                                            "type": "Expression"
                                        }
                                    },
                                    "MachineName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().DataFactory",
                                            "type": "Expression"
                                        }
                                    },
                                    "MasterPipelineExecutionLogKey": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@pipeline().parameters.MasterPipelineExecutionLogKey",
                                            "type": "Expression"
                                        }
                                    },
                                    "ParentCopyActivityExecutionLogKey": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "ServerExecutionId": {
                                        "type": "Int64",
                                        "value": "0"
                                    },
                                    "UserName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().TriggerName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "uspLogEventCopyActivityEnd",
                        "description": "Log the end of the successful execution of the steps in the pipeline ",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy Sink sql query to adls",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[dbo].[uspLogEventCopyActivityEnd]",
                            "storedProcedureParameters": {
                                "CopyActivityCopyDuration": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.copyDuration",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "CopyActivityDataRead": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.dataRead",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityDataWrite": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.dataWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityExecutionGroupName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivityExecutionGroupName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityFilesRead": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivityFilesWrite": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.filesWritten",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsCopied": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.rowsCopied",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "CopyActivityRowsSkipped": {
                                    "value": "0",
                                    "type": "Int64"
                                },
                                "CopyActivitySinkName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "CopyActivityStatus": {
                                    "value": "SUCCEEDED",
                                    "type": "String"
                                },
                                "CopyActivityThroughput": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.throughput",
                                        "type": "Expression"
                                    },
                                    "type": "Double"
                                },
                                "CopyActivityUsedCloudDataMovementUnits": {
                                    "value": "0",
                                    "type": "Int32"
                                },
                                "CopyActivityUsedParallelCopies": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').output.usedParallelCopies",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "uspLogEventPipeLineError",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SetActivityError Generic",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            },
                            {
                                "activity": "SetActivityError Copy sink sql query to adls",
                                "dependencyConditions": [
                                    "Completed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "uspLogEventCopyActivityError",
                            "storedProcedureParameters": {
                                "CopyActivityExecutionLogKey": {
                                    "value": {
                                        "value": "@activity('uspLogEventCopyActivityStart').output.firstRow.CopyActivityExecutionLogKey",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorCode": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').error.errorcode",
                                        "type": "Expression"
                                    },
                                    "type": "Int32"
                                },
                                "ErrorDescription": {
                                    "value": {
                                        "value": "@activity('Copy Sink sql query to adls').error.message",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "SourceName": {
                                    "value": {
                                        "value": "@pipeline().parameters.CopyActivitySinkName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "AzureSqlDatabase",
                            "type": "LinkedServiceReference"
                        }
                    },
                    {
                        "name": "SetActivityError Generic",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "Copy Data Activity Error"
                        }
                    },
                    {
                        "name": "uspGetCopyActivitySinkSQLToADLS",
                        "description": "Get list of copy activities.",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "uspLogEventCopyActivityStart",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[dbo].[uspGetCopyActivitySinkSQLToADLS]",
                                "storedProcedureParameters": {
                                    "CopyActivitySinkName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.CopyActivitySinkName",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "FrameworkAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Copy Sink sql query to adls",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderQuery": {
                                    "value": "@activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataSQLScript",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobFSWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false,
                            "dataIntegrationUnits": 0
                        },
                        "inputs": [
                            {
                                "referenceName": "MAPSAzureSqlTable",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "AzureDataLakeStoreFile_Json",
                                "type": "DatasetReference",
                                "parameters": {
                                    "FilePath": {
                                        "value": "@concat(pipeline().parameters.ContainerName,activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataADLSFolderPath)\n",
                                        "type": "Expression"
                                    },
                                    "FileName": {
                                        "value": "@activity('uspGetCopyActivitySinkSQLToADLS').output.firstRow.CopyActivityDataADLSFileName\n",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "SetActivityError uspGetCopyActivitySinkSQLToADLS",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "uspGetCopyActivitySinkSQLToADLS",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    },
                    {
                        "name": "SetActivityError Copy sink sql query to adls",
                        "description": "",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Copy Sink sql query to adls",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ActivityType",
                            "value": "uspGetCopyActivitySinkSQLToADLS"
                        }
                    }
                ],
                "parameters": {
                    "PipelineExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "APS Copy Process"
                    },
                    "ParentPipeLineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "CopyActivitySinkName": {
                        "type": "string",
                        "defaultValue": "APS_T_Dim_Product"
                    },
                    "CopyActivityExecutionGroupName": {
                        "type": "string",
                        "defaultValue": "APS Copy Process"
                    },
                    "MasterPipelineExecutionLogKey": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "cgs"
                    }
                },
                "variables": {
                    "ActivityType": {
                        "type": "String",
                        "defaultValue": "None"
                    }
                },
                "folder": {
                    "name": "MAPSCopyToDataLake"
                },
                "annotations": [
                    "@pipeline().parameters.PipelineExecutionGroupName",
                    "@pipeline().parameters.CopyActivitySinkName"
                ],
                "lastPublishTime": "2021-05-10T22:57:16Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/FrameworkAzureSqlTable')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase')]",
                "[concat(variables('factoryId'), '/datasets/MAPSAzureSqlTable')]",
                "[concat(variables('factoryId'), '/datasets/AzureDataLakeStoreFile_Json')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/MAPSCopyAndIngest')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "ResetMasterExecutionPlans",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "MAPS"
                            }
                        }
                    },
                    {
                        "name": "MAPS Copy",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "MAPSCopyDataPipelineLoop_SQL",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "SystemExecutionGroupName": "MAPS Copy Process",
                                "CopyActivityExecutionGroupName": "MAPS Copy Process"
                            }
                        }
                    },
                    {
                        "name": "MAPS Ingest",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "MAPS Copy",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookFramework",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "MAPS Ingest"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "SourceCopyAndIngest"
                },
                "annotations": [],
                "lastPublishTime": "2021-05-11T13:27:51Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/MAPSCopyDataPipelineLoop_SQL')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookFramework')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TaxProcessing')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Tax Sanction",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans_Tax",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "Tax Sanction"
                            }
                        }
                    },
                    {
                        "name": "ResetMasterExecutionPlans_Tax",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "CaseWareCopyIngestEnrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "MapsCopyIngestEnrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "Tax"
                            }
                        }
                    },
                    {
                        "name": "CaseWareCopyIngestEnrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "CaseWareCopyIngestEnrich",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "MapsCopyIngestEnrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "MapsCopyIngestEnrich",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    }
                ],
                "folder": {
                    "name": "TaxProcessing"
                },
                "annotations": [],
                "lastPublishTime": "2021-05-18T23:31:34Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookData001')]",
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/CaseWareCopyIngestEnrich')]",
                "[concat(variables('factoryId'), '/pipelines/MapsCopyIngestEnrich')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TaxProcessing_PostCopyAndIngest')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "ResetMasterExecutionPlans",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "Tax"
                            }
                        }
                    },
                    {
                        "name": "Tax Step1 Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "Tax-Step1 Enrich"
                            }
                        }
                    },
                    {
                        "name": "Tax Step2 Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Tax Step1 Enrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "Tax-Step2 Enrich"
                            }
                        }
                    },
                    {
                        "name": "Tax Sanction",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Tax Step2 Enrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "Tax Sanction"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "TaxProcessing"
                },
                "annotations": [],
                "lastPublishTime": "2021-05-13T19:23:01Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookData001')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/MapsCopyIngestEnrich')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "MAPSCopyAndIngest",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans_MAPS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "MAPSCopyAndIngest",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "ResetMasterExecutionPlans_MAPS",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "MAPS"
                            }
                        }
                    },
                    {
                        "name": "MAPS Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "MAPSCopyAndIngest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "MAPS Enrich"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "TaxProcessing"
                },
                "annotations": [],
                "lastPublishTime": "2021-05-18T23:29:58Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/MAPSCopyAndIngest')]",
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookData001')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/CaseWareCopyIngestEnrich')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "ResetMasterExecutionPlans_CaseWare",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "CaseWare"
                            }
                        }
                    },
                    {
                        "name": "CopyCaseware_dbf_fpt",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans_CaseWare",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "CopyCaseware_dbf_fpt",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "CaseWare Convert_Ingest",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "CopyCaseware_dbf_fpt",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Delete Caseware CurrentState DBs",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookFramework",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "CaseWare Convert"
                            }
                        }
                    },
                    {
                        "name": "CaseWare Step1 Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "CaseWare Convert_Ingest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "CaseWare-Step1 Enrich"
                            }
                        }
                    },
                    {
                        "name": "CaseWare Step2 Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "CaseWare Step1 Enrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "CaseWare-Step2 Enrich"
                            }
                        }
                    },
                    {
                        "name": "Delete Caseware CurrentState DBs",
                        "type": "Delete",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "CaseWareDBs",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "enableLogging": false,
                            "storeSettings": {
                                "type": "AzureBlobFSReadSettings",
                                "recursive": true,
                                "enablePartitionDiscovery": false
                            }
                        }
                    },
                    {
                        "name": "CaseWare Step3 Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "CaseWare Step2 Enrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "CaseWare-Step3 Enrich"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "TaxProcessing"
                },
                "annotations": [],
                "lastPublishTime": "2021-05-18T23:29:58Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/CopyCaseware_dbf_fpt')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookFramework')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookData001')]",
                "[concat(variables('factoryId'), '/datasets/CaseWareDBs')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/TaxProcessing_original')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "ResetMasterExecutionPlans_CaseWare",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "CaseWare"
                            }
                        }
                    },
                    {
                        "name": "CopyCaseware_dbf_fpt",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans_CaseWare",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "CopyCaseware_dbf_fpt",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "CaseWare Convert_Ingest",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "CopyCaseware_dbf_fpt",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Delete Caseware CurrentState DBs",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookFramework",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "CaseWare Convert"
                            }
                        }
                    },
                    {
                        "name": "MAPSCopyAndIngest",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans_MAPS",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "MAPSCopyAndIngest",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "Tax Sanction",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Tax Step3 Enrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "Tax Sanction"
                            }
                        }
                    },
                    {
                        "name": "ResetMasterExecutionPlans_MAPS",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "MAPS"
                            }
                        }
                    },
                    {
                        "name": "ResetMasterExecutionPlans_Tax",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "CaseWare Convert_Ingest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "MAPSCopyAndIngest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "ResetMasterExecutionPlans",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "ContainerName": "Tax"
                            }
                        }
                    },
                    {
                        "name": "Tax Step1 Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "ResetMasterExecutionPlans_Tax",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "Tax-Step1 Enrich"
                            }
                        }
                    },
                    {
                        "name": "Tax Step2 Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Tax Step1 Enrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "Tax-Step2 Enrich"
                            }
                        }
                    },
                    {
                        "name": "Delete Caseware CurrentState DBs",
                        "type": "Delete",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "CaseWareDBs",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "enableLogging": false,
                            "storeSettings": {
                                "type": "AzureBlobFSReadSettings",
                                "recursive": true,
                                "enablePartitionDiscovery": false
                            }
                        }
                    },
                    {
                        "name": "Tax Step3 Enrich",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Tax Step2 Enrich",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "LoopMasterNotebookData001",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "NotebookExecutionGroupName": "Tax-Step3 Enrich"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "TaxProcessing"
                },
                "annotations": [],
                "lastPublishTime": "2021-05-18T23:31:34Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/ResetMasterExecutionPlans')]",
                "[concat(variables('factoryId'), '/pipelines/CopyCaseware_dbf_fpt')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookFramework')]",
                "[concat(variables('factoryId'), '/pipelines/MAPSCopyAndIngest')]",
                "[concat(variables('factoryId'), '/pipelines/LoopMasterNotebookData001')]",
                "[concat(variables('factoryId'), '/datasets/CaseWareDBs')]"
            ]
        }
    ]
}